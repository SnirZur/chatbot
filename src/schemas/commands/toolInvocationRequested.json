{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["conversationId", "userId", "timestamp", "commandType", "payload"],
  "additionalProperties": false,
  "properties": {
    "conversationId": { "type": "string" },
    "userId": { "type": "string" },
    "timestamp": { "type": "string", "format": "date-time" },
    "commandType": { "const": "ToolInvocationRequested" },
    "payload": {
      "type": "object",
      "required": ["invocationId", "tool", "parameters", "stepIndex"],
      "additionalProperties": false,
      "properties": {
        "invocationId": { "type": "string" },
        "tool": {
          "type": "string",
          "enum": [
            "calculateMath",
            "getExchangeRate",
            "getWeather",
            "generalChat",
            "ragGeneration",
            "analyzeReview",
            "orchestrationSynthesis",
            "getProductInformation"
          ]
        },
        "parameters": { "type": "object" },
        "stepIndex": { "type": "integer", "minimum": 0 }
      },
      "allOf": [
        {
          "if": { "properties": { "tool": { "const": "calculateMath" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["expression"],
                "additionalProperties": false,
                "properties": {
                  "expression": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "getExchangeRate" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["from", "to"],
                "additionalProperties": false,
                "properties": {
                  "from": { "type": "string", "minLength": 1 },
                  "to": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "getWeather" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["city"],
                "additionalProperties": false,
                "properties": {
                  "city": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "generalChat" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["message"],
                "additionalProperties": false,
                "properties": {
                  "message": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "ragGeneration" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["ragPayload"],
                "additionalProperties": false,
                "properties": {
                  "ragPayload": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "analyzeReview" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["review_text"],
                "additionalProperties": false,
                "properties": {
                  "review_text": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "orchestrationSynthesis" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "minProperties": 1
              }
            }
          }
        },
        {
          "if": { "properties": { "tool": { "const": "getProductInformation" } } },
          "then": {
            "properties": {
              "parameters": {
                "type": "object",
                "required": ["query"],
                "additionalProperties": true,
                "properties": {
                  "query": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        }
      ]
    }
  }
}
